# apiVersion: helm.toolkit.fluxcd.io/v2beta1
# kind: HelmRelease
# metadata:
#   name: frigate
#   namespace: flux-system
# spec:
#   chart:
#     spec:
#       chart: frigate
#       sourceRef:
#         kind: HelmRepository
#         name: blakeblackshear
#         namespace: flux-system
#   interval: 10m0s
#   releaseName: frigate
#   targetNamespace: default
#   values:
#     #image:
#     #  repository: blakeblackshear/frigate
#     #  tag: blakeblackshear/frigate:0.11.0-amd64 
#     ingress:
#       enabled: true
#       annotations:
#         kubernetes.io/ingress.class: nginx
#         cert-manager.io/cluster-issuer: "letsencrypt-prod"
#         nginx.ingress.kubernetes.io/auth-url: https://auth.tallflix.ca/oauth2/auth
#         nginx.ingress.kubernetes.io/auth-signin: "https://auth.tallflix.ca/oauth2/start?rd=$scheme://$best_http_host$request_uri"
#         nginx.ingress.kubernetes.io/auth-response-headers: "X-Auth-Request-Preferred-Username"
#         nginx.org/proxy-read-timeout: "3600"
#         nginx.org/proxy-send-timeout: "3600"
#         nginx.org/websocket-services: "frigate"
#       tls:
#         - secretName: frigate-tls
#           hosts:
#             - frigate.tallflix.ca

#       hosts:
#        - host: frigate.tallflix.ca
#          paths:
#            - '/'

#     service:
#       type: LoadBalancer
#       loadBalancerIP: 10.10.10.66
#     env:
#       TZ: America/Toronto
#     envFromSecrets:
#     - frigate-secret
#     podSecurityContext:
#       supplementalGroups:
#       - 44
#       - 109
#     #resources:
#     #requests:
#     #gpu.intel.com/i915: 1
#     #limits:
#     #gpu.intel.com/i915: 1

#     extraVolumes:
#     - name: frigate-data
#       persistentVolumeClaim:
#         claimName: frigate-data-pvc
#     - name: frigate-recording
#       persistentVolumeClaim:
#         claimName: frigate-recording-pvc
#     extraVolumeMounts:
#     - mountPath: /media/frigate
#       name: frigate-data
#     - mountPath: /media/frigate/recordings
#       name: frigate-recording
#     config: "mqtt:\n  host: 10.10.10.64\n  port: 1883\n  topic_prefix: frigate\n  client_id: frigate\n  stats_interval: 60\n\nbirdseye:\n  # Optional: Enable birdseye view (default: shown below)\n  enabled: True\n  # Optional: Width of the output resolution (default: shown below)\n  width: 1280\n  # Optional: Height of the output resolution (default: shown below)\n  height: 720\n  # Optional: Encoding quality of the mpeg1 feed (default: shown below)\n  # 1 is the highest quality, and 31 is the lowest. Lower quality feeds utilize less CPU resources.\n  quality: 8\n  # Optional: Mode of the view. Available options are: objects, motion, and continuous\n  #   objects - cameras are included if they have had a tracked object within the last 30 seconds\n  #   motion - cameras are included if motion was detected in the last 30 seconds\n  #   continuous - all cameras are included always\n  mode: motion\n\ndetectors:\n  # coral:\n  #   type: edgetpu\n  #   device: usb\n  cpu1:\n    type: cpu\n\n#ffmpeg:\n#   hwaccel_args:\n#    - -hwaccel\n#    - qsv\n#    - -qsv_device\n#    - /dev/dri/renderD128\n\nrecord:\n  # Optional: Enable recording (default: shown below)\n  # WARNING: If recording is disabled in the config, turning it on via \n  #          the UI or MQTT later will have no effect.\n  # WARNING: Frigate does not currently support limiting recordings based\n  #          on available disk space automatically. If using recordings,\n  #          you must specify retention settings for a number of days that\n  #          will fit within the available disk space of your drive or Frigate\n  #          will crash.\n  enabled: true\n  # Optional: Number of minutes to wait between cleanup runs (default: shown below)\n  # This can be used to reduce the frequency of deleting recording segments from disk if you want to minimize i/o\n  expire_interval: 60\n  # Optional: Retention settings for recording\n  retain:\n    # Optional: Number of days to retain recordings regardless of events (default: shown below)\n    # NOTE: This should be set to 0 and retention should be defined in events section below\n    #       if you only want to retain recordings of events.\n    days: 0\n    # Optional: Mode for retention. Available options are: all, motion, and active_objects\n    #   all - save all recording segments regardless of activity\n    #   motion - save all recordings segments with any detected motion\n    #   active_objects - save all recording segments with active/moving objects\n    # NOTE: this mode only applies when the days setting above is greater than 0\n    mode: all\n\n  # Optional: Event recording settings\n  events:\n    # Optional: Number of seconds before the event to include (default: shown below)\n    pre_capture: 5\n    # Optional: Number of seconds after the event to include (default: shown below)\n    post_capture: 5\n    # Optional: Objects to save recordings for. (default: all tracked objects)\n    objects:\n      - person\n      - cat\n      - dog\n    # Optional: Restrict recordings to objects that entered any of the listed zones (default: no required zones)\n    required_zones: []\n    # Optional: Retention settings for recordings of events\n    retain:\n      # Required: Default retention days (default: shown below)\n      default: 10\n      # Optional: Mode for retention. (default: shown below)\n      #   all - save all recording segments for events regardless of activity\n      #   motion - save all recordings segments for events with any detected motion\n      #   active_objects - save all recording segments for event with active/moving objects\n      #\n      # NOTE: If the retain mode for the camera is more restrictive than the mode configured\n      #       here, the segments will already be gone by the time this mode is applied.\n      #       For example, if the camera retain mode is \"motion\", the segments without motion are\n      #       never stored, so setting the mode to \"all\" here won't bring them back.\n      mode: motion\n      # Optional: Per object retention days\n      objects:\n        person: 15\n\nsnapshots:\n  # Optional: Enable writing jpg snapshot to /media/frigate/clips (default: shown below)\n  # This value can be set via MQTT and will be updated in startup based on retained value\n  enabled: True\n  # Optional: save a clean PNG copy of the snapshot image (default: shown below)\n  #clean_copy: True\n  # Optional: print a timestamp on the snapshots (default: shown below)\n  timestamp: False\n  # Optional: draw bounding box on the snapshots (default: shown below)\n  bounding_box: True\n  # Optional: crop the snapshot (default: shown below)\n  #crop: False\n  # Optional: height to resize the snapshot to (default: original size)\n  # height: 768\n  # Optional: Restrict snapshots to objects that entered any of the listed zones (default: no required zones)\n  #required_zones: []\n  # Optional: Camera override for retention settings (default: global values)\n  retain:\n    # Required: Default retention days (default: shown below)\n    default: 10\n    # Optional: Per object retention days\n    objects:\n      person: 15\n\n# Optional: Motion configuration\n# NOTE: Can be overridden at the camera level\nmotion:\n  # Optional: The threshold passed to cv2.threshold to determine if a pixel is different enough to be counted as motion. (default: 25)\n  # Increasing this value will make motion detection less sensitive and decreasing it will make motion detection more sensitive.\n  # The value should be between 1 and 255.\n  threshold: 40\n  # Optional: Minimum size in pixels in the resized motion image that counts as motion (default: 30)\n  # Increasing this value will prevent smaller areas of motion from being detected. Decreasing will\n  # make motion detection more sensitive to smaller moving objects.\n  # As a rule of thumb:\n  #  - 15 - high sensitivity\n  #  - 30 - medium sensitivity\n  #  - 50 - low sensitivity\n  contour_area: 30\n\ncameras:\n  doorbell:\n    ffmpeg:\n      output_args:\n        record: -f segment -segment_time 10 -segment_format mp4 -reset_timestamps 1 -strftime 1 -c:v copy -c:a aac\n      inputs:\n        - path: rtsp://admin:{FRIGATE_DOORBELL_RTSP_PASSWORD}@10.10.10.228:554/Streaming/channels/101\n          roles:\n            - detect\n            - rtmp  \n    detect:\n      width: 1536\n      height: 2160\n      fps: 5\n    objects:\n      track:\n        - person\n        - cat\n        - dog\n      filters:\n        person:\n          min_area: 20000\n    mqtt:\n      crop: False\n\n  kid1:\n    ffmpeg:\n      output_args:\n        record: -f segment -segment_time 10 -segment_format mp4 -reset_timestamps 1 -strftime 1 -c:v copy -c:a aac\n      inputs:\n        #- path: rtsp://wyzecam1:{FRIGATE_WYZE1_RTSP_PASSWORD}@10.10.10.215/live\n        - path: rtsp://wyzebridge.default.svc.cluster.local:8554/finnstagram\n          roles:\n            - detect\n    detect:\n      width: 1920\n      height: 1080\n      fps: 5\n    mqtt:\n      crop: False\n\n  kid2:\n    ffmpeg:\n      output_args:\n        record: -f segment -segment_time 10 -segment_format mp4 -reset_timestamps 1 -strftime 1 -c:v copy -c:a aac\n      inputs:\n        #- path: rtsp://wyzecam1:{FRIGATE_WYZE1_RTSP_PASSWORD}@10.10.10.187/live\n        - path: rtsp://wyzebridge.default.svc.cluster.local:8554/kanekam\n          roles:\n            - detect\n    detect:\n      width: 1920\n      height: 1080\n      fps: 5\n    mqtt:\n      crop: False        "
